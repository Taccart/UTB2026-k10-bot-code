{
  "openapi": "3.0.0",
  "info": {
    "title": "K10 Bot API",
    "version": "1.0.0",
    "description": "API for controlling UNIHIKER K10 robot including servos, motors, sensors, camera, and board information"
    ,"contact": {
      "name": "aMaker club",
      "url": "https://amadeus.atlassian.net/wiki/spaces/aMaker",
      "email": ""
      ,"description": "For support, contact Thierry."
  },
  "servers": [
    {
      "url": "/api",  
      "description": "K10 Bot API Server"
    }
  ],
  "tags": [
    {
      "name": "OpenAPI",
      "description": "OpenAPI specification endpoints"
    },
    {
      "name": "Board Info",
      "description": "Board and system information"
    },
    {
      "name": "Servos",
      "description": "Servo motor control endpoints"
    },
    {
      "name": "DFR1216",
      "description": "DFR1216 expansion board control (servos and motors)"
    },
    {
      "name": "Webcam",
      "description": "Camera and image capture endpoints"
    },
    {
      "name": "UDP",
      "description": "UDP service status and messages"
    },
    {#ifdef DEBUG
      "name": "Settings",
      "description": "Configuration and settings management"
    }
  ],
  "paths": {
    "/api/openapi.json": {
      "get": {
        "tags": ["OpenAPI"],
        "summary": "Get OpenAPI specification",
        "description": "Get OpenAPI 3.0.0 specification for all registered services including paths, parameters, request bodies, and response schemas",
        "responses": {
          "200": {
            "description": "OpenAPI specification retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "openapi": {
                      "type": "string"
                    },
                    "info": {
                      "type": "object"
                    },
                    "paths": {
                      "type": "object"
                    }
                  }
                },
                "example": {
                  "openapi": "3.0.0",
                  "info": {
                    "title": "K10 Bot API",
                    "version": "1.0.0"
                  },
                  "paths": {}
                }
              }
            }
          }
        }
      }
    },
    "/api/board_info/": {
      "get": {
        "tags": ["Board Info"],
        "summary": "Get board information",
        "description": "Retrieves comprehensive board information including system metrics, memory usage, chip details, and firmware version",
        "responses": {
          "200": {
            "description": "Board information retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "uptimeMs": {
                      "type": "integer",
                      "description": "System uptime in milliseconds"
                    },
                    "board": {
                      "type": "string",
                      "description": "Board model name"
                    },
                    "version": {
                      "type": "string",
                      "description": "Firmware version"
                    },
                    "heapTotal": {
                      "type": "integer",
                      "description": "Total heap size in bytes"
                    },
                    "heapFree": {
                      "type": "integer",
                      "description": "Free heap size in bytes"
                    },
                    "freeStackBytes": {
                      "type": "integer",
                      "description": "Free stack space for current task"
                    },
                    "chipCores": {
                      "type": "integer",
                      "description": "Number of CPU cores"
                    },
                    "chipModel": {
                      "type": "string",
                      "description": "Chip model name"
                    },
                    "chipRevision": {
                      "type": "integer",
                      "description": "Chip revision number"
                    },
                    "cpuFreqMHz": {
                      "type": "integer",
                      "description": "CPU frequency in MHz"
                    },
                    "freeSketchSpace": {
                      "type": "integer",
                      "description": "Available flash space for sketch"
                    },
                    "sdkVersion": {
                      "type": "string",
                      "description": "ESP-IDF SDK version"
                    }
                  }
                },
                "example": {
                  "uptimeMs": 123456,
                  "board": "UNIHIKER_K10",
                  "version": "1.0.0",
                  "heapTotal": 327680,
                  "heapFree": 280000,
                  "freeStackBytes": 2048,
                  "chipCores": 2,
                  "chipModel": "ESP32-S3",
                  "chipRevision": 1,
                  "cpuFreqMHz": 240,
                  "freeSketchSpace": 1310720,
                  "sdkVersion": "v4.4.2"
                }
              }
            }
          }
        }
      }
    },
    "/api/Servo Service/set_angle": {
      "post": {
        "tags": ["Servos"],
        "summary": "Set servo angle",
        "description": "Set servo angle",
        "parameters": [
          {
            "name": "channel",
            "in": "query",
            "description": "Servo channel (0-7)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "maximum": 7
            }
          },
          {
            "name": "angle",
            "in": "query",
            "description": "Angle in degrees (0-360)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "maximum": 360
            }
          }
        ],
        "requestBody": {
          "description": "Servo angle control",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "channel": {
                    "type": "integer"
                  },
                  "angle": {
                    "type": "integer"
                  }
                }
              },
              "example": {
                "channel": 0,
                "angle": 90
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation successful",
            "content": {
              "application/json": {
                "example": {
                  "result": "ok",
                  "message": "set_angle"
                }
              }
            }
          },
          "422": {
            "description": "Missing or invalid parameters"
          },
          "456": {
            "description": "Operation failed"
          },
          "503": {
            "description": "Service not initialized"
          }
        }
      }
    },
    "/api/Servo Service/set_speed": {
      "post": {
        "tags": ["Servos"],
        "summary": "Set servo speed",
        "description": "Set servo speed",
        "parameters": [
          {
            "name": "channel",
            "in": "query",
            "description": "Servo channel (0-7)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "maximum": 7
            }
          },
          {
            "name": "speed",
            "in": "query",
            "description": "Speed as percentage (-100 to 100)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": -100,
              "maximum": 100
            }
          }
        ],
        "requestBody": {
          "description": "Servo speed control",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "channel": {
                    "type": "integer"
                  },
                  "speed": {
                    "type": "integer"
                  }
                }
              },
              "example": {
                "channel": 0,
                "speed": 50
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation successful"
          },
          "422": {
            "description": "Missing or invalid parameters"
          },
          "456": {
            "description": "Operation failed"
          },
          "503": {
            "description": "Service not initialized"
          }
        }
      }
    },
    "/api/Servo Service/stop_all": {
      "post": {
        "tags": ["Servos"],
        "summary": "Stop all servos",
        "description": "Stop all servos",
        "responses": {
          "200": {
            "description": "Operation successful"
          },
          "422": {
            "description": "Missing or invalid parameters"
          },
          "456": {
            "description": "Operation failed"
          },
          "503": {
            "description": "Service not initialized"
          }
        }
      }
    },
    "/api/Servo Service/status": {
      "get": {
        "tags": ["Servos"],
        "summary": "Get servo status",
        "description": "Get servo status",
        "parameters": [
          {
            "name": "channel",
            "in": "query",
            "description": "Servo channel (0-7)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "maximum": 7
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Servo status retrieved successfully",
            "content": {
              "application/json": {
                "example": {
                  "channel": 0,
                  "attached": true,
                  "angle": 90
                }
              }
            }
          },
          "422": {
            "description": "Missing or invalid parameters"
          }
        }
      }
    },
    "/api/Servo Service/status_all": {
      "get": {
        "tags": ["Servos"],
        "summary": "Get all servos status",
        "description": "Get all servos status",
        "responses": {
          "200": {
            "description": "All servos status retrieved successfully",
            "content": {
              "application/json": {
                "example": {
                  "servos": [
                    {
                      "channel": 0,
                      "attached": true,
                      "angle": 90
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/Servo Service/set_all_angle": {
      "post": {
        "tags": ["Servos"],
        "summary": "Set all servos to same angle",
        "description": "Set all servos to same angle",
        "parameters": [
          {
            "name": "angle",
            "in": "query",
            "description": "Angle in degrees (0-360)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "maximum": 360
            }
          }
        ],
        "requestBody": {
          "description": "Angle for all servos",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "angle": {
                    "type": "integer"
                  }
                }
              },
              "example": {
                "angle": 90
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation successful"
          },
          "422": {
            "description": "Missing or invalid parameters"
          },
          "456": {
            "description": "Operation failed"
          },
          "503": {
            "description": "Service not initialized"
          }
        }
      }
    },
    "/api/Servo Service/set_all_speed": {
      "post": {
        "tags": ["Servos"],
        "summary": "Set all servos to same speed",
        "description": "Set all servos to same speed",
        "parameters": [
          {
            "name": "speed",
            "in": "query",
            "description": "Speed as percentage (-100 to 100)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": -100,
              "maximum": 100
            }
          }
        ],
        "requestBody": {
          "description": "Speed for all servos",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "speed": {
                    "type": "integer"
                  }
                }
              },
              "example": {
                "speed": 50
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation successful"
          },
          "422": {
            "description": "Missing or invalid parameters"
          },
          "456": {
            "description": "Operation failed"
          },
          "503": {
            "description": "Service not initialized"
          }
        }
      }
    },
    "/api/Servo Service/attach_servo": {
      "post": {
        "tags": ["Servos"],
        "summary": "Attach servo",
        "description": "Attach servo",
        "parameters": [
          {
            "name": "channel",
            "in": "query",
            "description": "Servo channel (0-7)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "maximum": 7
            }
          },
          {
            "name": "speed",
            "in": "query",
            "description": "Connection type",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "description": "Attachment configuration",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "channel": {
                    "type": "integer"
                  },
                  "connection": {
                    "type": "integer"
                  }
                }
              },
              "example": {
                "channel": 0,
                "connection": 1
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation successful"
          },
          "422": {
            "description": "Missing or invalid parameters"
          },
          "456": {
            "description": "Operation failed"
          },
          "503": {
            "description": "Service not initialized"
          }
        }
      }
    },
    "/api/DFR1216Service/set_servo_angle": {
      "post": {
        "tags": ["DFR1216"],
        "summary": "Set DFR1216 servo angle",
        "description": "Set servo angle",
        "parameters": [
          {
            "name": "channel",
            "in": "query",
            "description": "Servo channel (0-5)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "maximum": 5
            }
          },
          {
            "name": "angle",
            "in": "query",
            "description": "Angle in degrees (0-180)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "maximum": 180
            }
          }
        ],
        "requestBody": {
          "description": "Servo parameters",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "channel": {
                    "type": "integer"
                  },
                  "angle": {
                    "type": "integer"
                  }
                }
              },
              "example": {
                "channel": 0,
                "angle": 90
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Servo angle set successfully",
            "content": {
              "application/json": {
                "example": {
                  "status": "success",
                  "channel": 0,
                  "angle": 90
                }
              }
            }
          },
          "422": {
            "description": "Missing or invalid parameters"
          },
          "503": {
            "description": "Service not initialized"
          }
        }
      }
    },
    "/api/DFR1216Service/set_motor_speed": {
      "post": {
        "tags": ["DFR1216"],
        "summary": "Set DFR1216 motor speed",
        "description": "Set motor speed",
        "parameters": [
          {
            "name": "motor",
            "in": "query",
            "description": "Motor number (1-2)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 2
            }
          },
          {
            "name": "speed",
            "in": "query",
            "description": "Speed as percentage (-100 to 100)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": -100,
              "maximum": 100
            }
          }
        ],
        "requestBody": {
          "description": "Motor parameters",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "motor": {
                    "type": "integer"
                  },
                  "speed": {
                    "type": "integer"
                  }
                }
              },
              "example": {
                "motor": 1,
                "speed": 75
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Motor speed set successfully",
            "content": {
              "application/json": {
                "example": {
                  "status": "success",
                  "motor": 1,
                  "speed": 75
                }
              }
            }
          },
          "422": {
            "description": "Missing or invalid parameters"
          },
          "503": {
            "description": "Service not initialized"
          }
        }
      }
    },
    "/api/DFR1216Service/status": {
      "get": {
        "tags": ["DFR1216"],
        "summary": "Get DFR1216 status",
        "description": "Get status",
        "responses": {
          "200": {
            "description": "Status retrieved successfully",
            "content": {
              "application/json": {
                "example": {
                  "service": "DFR1216Service",
                  "initialized": true,
                  "status": "running"
                }
              }
            }
          }
        }
      }
    },
    "/api/webcam/snapshot": {
      "get": {
        "tags": ["Webcam"],
        "summary": "Capture snapshot",
        "description": "Capture a single JPEG snapshot from the camera",
        "responses": {
          "200": {
            "description": "Snapshot captured successfully",
            "content": {
              "image/jpeg": {
                "schema": {
                  "type": "string",
                  "format": "binary",
                  "description": "JPEG image data"
                }
              }
            }
          },
          "503": {
            "description": "Camera not initialized"
          }
        }
      }
    },
    "/api/webcam/status": {
      "get": {
        "tags": ["Webcam"],
        "summary": "Get camera status",
        "description": "Get camera status and settings",
        "responses": {
          "200": {
            "description": "Status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "initialized": {
                      "type": "boolean",
                      "description": "Whether camera is initialized"
                    },
                    "status": {
                      "type": "string",
                      "enum": ["ready", "sensor_error", "not_initialized"]
                    },
                    "settings": {
                      "type": "object",
                      "properties": {
                        "framesize": {
                          "type": "integer",
                          "description": "Frame size code (0-13)"
                        },
                        "framesize_name": {
                          "type": "string",
                          "description": "Frame size name (e.g., SVGA, VGA)"
                        },
                        "quality": {
                          "type": "integer",
                          "description": "JPEG quality (0-63, lower is better)"
                        },
                        "brightness": {
                          "type": "integer",
                          "description": "Brightness level (-2 to 2)"
                        },
                        "contrast": {
                          "type": "integer",
                          "description": "Contrast level (-2 to 2)"
                        },
                        "saturation": {
                          "type": "integer",
                          "description": "Saturation level (-2 to 2)"
                        }
                      }
                    }
                  }
                },
                "example": {
                  "initialized": true,
                  "status": "ready",
                  "settings": {
                    "framesize": 9,
                    "framesize_name": "SVGA",
                    "quality": 12,
                    "brightness": 0,
                    "contrast": 0,
                    "saturation": 0
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/udp/": {
      "get": {
        "tags": ["UDP"],
        "summary": "Get UDP service status",
        "description": "Get UDP service status and recent messages",
        "responses": {
          "200": {
            "description": "UDP status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "port": {
                      "type": "integer",
                      "description": "UDP listening port"
                    },
                    "total": {
                      "type": "integer",
                      "description": "Total messages received since start"
                    },
                    "dropped": {
                      "type": "integer",
                      "description": "Number of packets dropped due to buffer lock"
                    },
                    "buffer": {
                      "type": "string",
                      "description": "Current buffer usage (used/max)"
                    },
                    "messages": {
                      "type": "array",
                      "description": "Recent messages with timestamps",
                      "items": {
                        "type": "string"
                      }
                    },
                    "error": {
                      "type": "string",
                      "description": "Error message if buffer is locked"
                    }
                  }
                },
                "example": {
                  "port": 12345,
                  "total": 1523,
                  "dropped": 5,
                  "buffer": "15/20",
                  "messages": [
                    "[125 ms] Hello",
                    "[230 ms] World"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/SettingsService/settings": {
      "get": {
        "tags": ["Settings"],
        "summary": "Get settings",
        "description": "Retrieve a single setting value or all settings in a domain",
        "parameters": [
          {
            "name": "domain",
            "in": "query",
            "description": "Settings domain/namespace (max 15 chars, alphanumeric and underscore)",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 15
            }
          },
          {
            "name": "key",
            "in": "query",
            "description": "Setting key (max 15 chars, alphanumeric and underscore)",
            "required": false,
            "schema": {
              "type": "string",
              "maxLength": 15
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "example": {
                  "domain": "wifi",
                  "settings": {}
                }
              }
            }
          },
          "422": {
            "description": "Invalid parameters"
          }
        }
      },
      "post": {
        "tags": ["Settings"],
        "summary": "Set settings",
        "description": "Update or insert setting. Use query parameters.",
        "parameters": [
          {
            "name": "domain",
            "in": "query",
            "description": "Settings domain/namespace (max 15 chars, alphanumeric and underscore)",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 15
            }
          },
          {
            "name": "key",
            "in": "query",
            "description": "Setting key for single update (max 15 chars)",
            "required": false,
            "schema": {
              "type": "string",
              "maxLength": 15
            }
          },
          {
            "name": "value",
            "in": "query",
            "description": "Setting value for single update",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Settings updated successfully",
            "content": {
              "application/json": {
                "example": {
                  "success": true,
                  "message": "Operation successful."
                }
              }
            }
          },
          "422": {
            "description": "Invalid parameters"
          },
          "503": {
            "description": "Operation failed"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ResultResponse": {
        "type": "object",
        "properties": {
          "result": {
            "type": "string",
            "enum": ["ok", "err"]
          },
          "message": {
            "type": "string"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string"
          }
        }
      }
    }
  }
}
